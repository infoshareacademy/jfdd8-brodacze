<!DOCTYPE HTML>
<html lang="pl">


<html>
<head>
    <meta charset="utf-8">

    <title>Pocketbook</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>

<style>
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background-image: url("images/money.jpg");
        background-size: cover;
    }

    .table {
        display: flex;
        width: 650px;
        height: 650px;
        align-items: stretch;
        flex-direction: column;
        background-color: antiquewhite;
        background-size: auto;
        opacity: 1;
        border-radius: 40px;
    }

    .table > div {
        display: flex;
        flex-grow: 1;
    }

    .table > div > div {
        flex-grow: 1;
        margin: 10px;
        /*border: 1px solid black;*/
    }

    .egg {
        background-image: url("images/coin.png");
    }

    .basket {
        background-image: url("images/basket.png");
    }
</style>

<body>
<div id="score">0</div>
<div id="app"></div>
<button id="start-game">Start</button>

<script src="js/jquery-3.2.1.js"></script>
<script>
    $(document).ready(function () {
        var size = 10;
        var score = 0;
        var gameIntervalId;
        var eggsIntervalId;
        var $app = $('#app');
        var $board = createBoard();
        $app.append($board);



        $('#start-game').click(play);

        function range(size) {
            return Array.from({ length: size })
        }

        function createBoard() {
            return $('<div>').addClass('table').append(
                range(size).map(function () {
                    return $('<div>').append(range(size).map(function () {
                        return $('<div>')
                    }))
                })
            );
        }

        function drawEggStartingPosition() {
            return $('.table div:first div').eq(
                Math.floor(Math.random() * size)
            )
        }

        function createBasket($node) {
            $node.addClass('basket')
        }

        function createEgg($node) {
            $node.addClass('egg')
        }

        function moveEggs() {
            $('.egg').each(function () {
                var $currentNode = $(this);
                var $targetNode = $currentNode.parent().next().find('div').eq($currentNode.index())

                if ($targetNode.length === 0) {
                    updateScore(-1)
                }
                $currentNode.removeClass('egg');
                $targetNode.addClass('egg');

            })
        }

        function moveBasketRight() {
            var $currentNode = $('.basket');
            var $targetNode = $currentNode.next();

            if ($targetNode.length === 0) {
                // skip
            } else {
                $currentNode.removeClass('basket');
                $targetNode.addClass('basket');
            }
        }

        function moveBasketLeft() {
            var $currentNode = $('.basket');
            var $targetNode = $currentNode.prev();

            if ($targetNode.length === 0) {
                // skip
            } else {
                $currentNode.removeClass('basket');
                $targetNode.addClass('basket');
            }
        }

        function detectCatch() {
            var $catchNode = $('.basket.egg');
            if ($catchNode.length > 0) {
                // console.log('CATCHED!')
                updateScore(1);
                $catchNode.removeClass('egg');
            }
        }

        function updateScore(delta) {
            score += delta;
            $('#score').text(score);
        }

        function play() {
            score = 0;
            updateScore(0);
            $('.egg, .basket').removeClass('egg basket');
            var $basketPosition = $('.table > div:last > div').eq(4);
            createBasket($basketPosition);

            $(window).off('keyup');
            $(window).on('keyup', function (event) {
                // console.log(event.keyCode);
                switch (event.keyCode) {
                    case 39:
                        moveBasketRight();
                        break;

                    case 37:
                        moveBasketLeft();
                        break;
                }
                detectCatch()
            });

            clearInterval(gameIntervalId);
            gameIntervalId = setInterval(function () {
                moveEggs();
                detectCatch();
            }, 500);

            clearInterval(eggsIntervalId);
            eggsIntervalId = setInterval(function () {
                var $eggPosition = drawEggStartingPosition();
                createEgg($eggPosition);
            }, 500);
        }
    })
</script>
</body>
</html>
