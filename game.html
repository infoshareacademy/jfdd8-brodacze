<style>
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background-image: url("images/money_ls01.jpg");
    }

    .table {
        display: flex;
        width: 500px;
        height: 500px;
        align-items: stretch;
        flex-direction: column;
        border: 1px solid darkslategrey;

    }

    .table > div {
        display: flex;
        flex-grow: 1;

    }

    .table > div > div {
        flex-grow: 1;
        background-color: lightcyan;
    }

    .egg {
        background-size: cover;
        background-image: url("images/coin_ls.png");
        size: 75%;
    }

    .basket {
        background-size: cover;
        background-image: url("images/piggybank.png");
    }
    #score {
        font-size: 2em;
        color: purple;
        background-color: lightcyan;
        padding-left: auto;
        padding-right: auto;
    }
    #start-game{
        background-color: purple;
        color: gold;
        font-size: 2em;
        border: purple;
        border-radius: 45px;
        margin-top: 7px;
        padding-left: 25px;
        padding-right: 25px;

</style>

<div id="score">0</div>
<div id="app"></div>
<button id="start-game">Start</button>

<script src="js/jquery-3.2.1.js"></script>
<script>
    $(document).ready(function () {
        var size = 10;
        var score = 0;
        var gameIntervalId;
        var eggsIntervalId;
        var intervalSize = 1000;
        var $app = $('#app');
        var $board = createBoard();
        $app.append($board);



        $('#start-game').click(play);

        function range(size) {
            return Array.from({ length: size })
        }

        function createBoard() {
            return $('<div>').addClass('table').append(
                range(size).map(function () {
                    return $('<div>').append(range(size).map(function () {
                        return $('<div>')
                    }))
                })
            );
        }

        function drawEggStartingPosition() {
            return $('.table div:first div').eq(
                Math.floor(Math.random() * size)
            )
        }

        function createBasket($node) {
            $node.addClass('basket')
        }

        function createEgg($node) {
            $node.addClass('egg')
        }

        function moveEggs() {
            $('.egg').each(function () {
                var $currentNode = $(this);
                var $targetNode = $currentNode.parent().next().find('div').eq($currentNode.index())

                if ($targetNode.length === 0) {
                    updateScore(-1)
                }
                $currentNode.removeClass('egg');
                $targetNode.addClass('egg');

            })
        }

        function moveBasketRight() {
            var $currentNode = $('.basket');
            var $targetNode = $currentNode.next();

            if ($targetNode.length === 0) {
                // skip
            } else {
                $currentNode.removeClass('basket');
                $targetNode.addClass('basket');
            }
        }

        function moveBasketLeft() {
            var $currentNode = $('.basket');
            var $targetNode = $currentNode.prev();

            if ($targetNode.length === 0) {
                // skip
            } else {
                $currentNode.removeClass('basket');
                $targetNode.addClass('basket');
            }
        }

        function detectCatch() {
            var $catchNode = $('.basket.egg');
            if ($catchNode.length > 0) {
                // console.log('CATCHED!')
                updateScore(1);
                $catchNode.removeClass('egg');
            }
        }

        function updateScore(delta) {
            score += delta;
            $('#score').text(score);
            if (score % 10 === 0) { riseSpeed() } // dopisane obniżanie interwału co 10pkt
        }

        function play() {
            score = 0;
            updateScore(0);
            $('.egg, .basket').removeClass('egg basket');
            var $basketPosition = $('.table > div:last > div').eq(4);
            createBasket($basketPosition);

            $(window).off('keyup');
            $(window).on('keyup', function (event) {
                // console.log(event.keyCode);
                switch (event.keyCode) {
                    case 39:
                        moveBasketRight();
                        break;

                    case 37:
                        moveBasketLeft();
                        break;
                }
                detectCatch()
            });

            clearInterval(gameIntervalId);
            gameIntervalId = setInterval(function () {
                moveEggs();
                detectCatch();
            }, 700);

            clearInterval(eggsIntervalId);
            eggsIntervalId = setInterval(function () {
                var $eggPosition = drawEggStartingPosition();
                createEgg($eggPosition);
            }, 1000);
        }

        function riseSpeed() { // funkcja zwiększająca prędkość tworzenia nowych jaj.
            intervalSize -= 200;
            clearInterval(eggsIntervalId);
            eggsIntervalId = setInterval(function () {
                var $eggPosition = drawEggStartingPosition();
                createEgg($eggPosition);
            }, intervalSize);
        }

        function end() {
            if (score === 20) {
                alert("Osiągnąłeś zamierzony cel")
            }
        }
    })
</script>

